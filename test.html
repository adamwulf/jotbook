<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr" id="html">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Listotron Unit Tests</title>
    <link rel="Stylesheet" media="screen" href="includes/testsuite.css"/>
    <script type="text/javascript" src="includes/jquery.js"></script>
    <script type="text/javascript" src="includes/jqUnit.js"></script>

		<script src="includes/bajax.js" type="text/javascript"></script>
		<script src="model.js" type="text/javascript"></script>
		<script src="util.js" type="text/javascript"></script>
		<script src="view.js" type="text/javascript"></script>
		<script src="controller.js" type="text/javascript"></script>
		<script type="text/javascript">
			$(function(){
				var model = new $.Model();
				var view = new $.View($("#interface"));
				var controller = new $.Controller(model, view, false);

				var testDuration = 4000;
				var waitForAnswer = 1000;

				jqUnit.module('Listotron');
				var running = 7;
				setTimeout(function(){
					setInterval(function(){	
						if(running == 0){
							jqUnit.test('test loading model', function(){
								jqUnit.equals(typeof(model.getRow(1)), "object");
								jqUnit.equals(typeof(model.getRow(2)), "object");
								jqUnit.equals(typeof(model.getRow(3)), "object");
								jqUnit.equals(typeof(model.getRow(4)), "object");
								jqUnit.equals(typeof(model.getRow(5)), "object");
								jqUnit.equals(typeof(model.getRow(6)), "object");
							});
							jqUnit.test('test loading view', function(){
								jqUnit.equals(typeof(view.getRowLI(1)), "object");
								jqUnit.equals(typeof(view.getRowLI(2)), "object");
								jqUnit.equals(typeof(view.getRowLI(3)), "object");
								jqUnit.equals(typeof(view.getRowLI(4)), "object");
								jqUnit.equals(typeof(view.getRowLI(5)), "object");
								jqUnit.equals(typeof(view.getRowLI(6)), "object");
							});
						}else if(running == 1){
							jqUnit.test('test basic indent', function(){
	
								jqUnit.expect(2);
								var row = view.getRowLI(4);
								jqUnit.equals(row.getRow().getParentId(), 1);
								view.indent(row);
								jqUnit.stop();
								setTimeout(function(){
									jqUnit.equals(view.getRowLI(4).getRow().getParentId(), 3);
									jqUnit.start();
								}, waitForAnswer);
								
							});
						}else if(running == 2){
							jqUnit.test('test basic outdent', function(){
	
								jqUnit.expect(2);
								var row = view.getRowLI(4);
								jqUnit.equals(row.getRow().getParentId(), 3);
								view.outdent(row);
								jqUnit.stop();
								setTimeout(function(){
									jqUnit.equals(view.getRowLI(4).getRow().getParentId(), 1);
									jqUnit.start();
								}, waitForAnswer);
	
							});
						}else if(running == 3){
							jqUnit.test('test failed double indent', function(){
	
								jqUnit.expect(2);
								var row = view.getRowLI(4);
								jqUnit.equals(row.getRow().getParentId(), 1);
								view.indent(row);
								view.indent(row);
								jqUnit.stop();
								setTimeout(function(){
									jqUnit.equals(view.getRowLI(4).getRow().getParentId(), 3);
									jqUnit.start();
								}, waitForAnswer);
								
							});
						}else if(running == 4){
							jqUnit.test('test failed triple outdent', function(){
								var row = view.getRowLI(4);
								jqUnit.expect(3);
								jqUnit.equals(view.getRowLI(4).getRow().getParentId(), 3);
								view.outdent(row);
								view.outdent(row);
								view.outdent(row);
								jqUnit.stop();
								setTimeout(function(){
									jqUnit.equals(row.getRow().getParentId(), null);
									view.indent(view.getRowLI(4));
									setTimeout(function(){
										jqUnit.equals(view.getRowLI(4).getRow().getParentId(), 1);
										jqUnit.start();
									}, waitForAnswer);
								}, waitForAnswer);
							});
						}else if(running == 5){
							jqUnit.test('test failed triple outdent', function(){
								jqUnit.expect(9);
								jqUnit.equals(view.getRowLI(4).getRow().getParentId(), 1);
								jqUnit.equals(view.getRowLI(5).getRow().getParentId(), 4);
								jqUnit.equals(view.getRowLI(6).getRow().getParentId(), 4);
								view.outdent(view.getRowLI(4));
								view.outdent(view.getRowLI(5));
								view.outdent(view.getRowLI(6));
								jqUnit.stop();
								setTimeout(function(){
									jqUnit.equals(view.getRowLI(4).getRow().getParentId(), null);
									jqUnit.equals(view.getRowLI(5).getRow().getParentId(), null);
									jqUnit.equals(view.getRowLI(6).getRow().getParentId(), null);
									view.indent(view.getRowLI(4));
									view.indent(view.getRowLI(5));
									view.indent(view.getRowLI(6));
									setTimeout(function(){
										jqUnit.equals(view.getRowLI(4).getRow().getParentId(), 1);
										jqUnit.equals(view.getRowLI(5).getRow().getParentId(), 1);
										jqUnit.equals(view.getRowLI(6).getRow().getParentId(), 1);
										jqUnit.start();
									}, waitForAnswer);
								}, waitForAnswer);
							});
						}else if(running == 7){
							jqUnit.test('test delete two rows', function(){
								jqUnit.expect(2);
								view.selectRow(view.getRowLI(6));
								view.deleteRow(view.getRowLI(6));
								jqUnit.stop();
								setTimeout(function(){
									jqUnit.equals(view.getRowLI(5).getRow().getPrevious().getRowId(), 4);
									view.deleteRow(view.getRowLI(5));
									setTimeout(function(){
										jqUnit.equals(view.getRowLI(4).getRow().getPrevious().getRowId(), 3);
										jqUnit.start();
									}, waitForAnswer);
								}, waitForAnswer);
							});
						}
						running ++;
					}, testDuration);
				}, 500);
			});
		</script>
		<style>
		li span{
			display: block;
			padding:3px;
		}
		li input{
			width: 90%;
		}
		</style>
  </head>
  <body id="body">
    <h1 id="header">Test Title Goes Here</h1>
		
    <h2 id="banner"></h2>
		
    <h2 id="userAgent"></h2>
		
    <!-- Test HTML -->
    <div id="main" style="display: none;">
      <form id="test-form">
        <input/>
      </form>
      <div id="ajax">
        
      </div>
    </div>
    <ol id="tests"></ol>

<div id="interface">
</div>
<input type='button' value='stop' id='stopbutton'>

  </body>
</html>
